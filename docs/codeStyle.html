<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Developer Guidelines</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel='shortcut icon' type='image/x-icon' href='favicon.ico' />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><img src="images/hadesMini.png" width = 80 height = 17/></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="packages.html">
    <span class="fas fa-cube"></span>
     
    Packages
  </a>
</li>
<li>
  <a href="validation.html">
    <span class="fas fa-clipboard-check"></span>
     
    Validation
  </a>
</li>
<li>
  <a href="publications.html">
    <span class="fas fa-pen-alt"></span>
     
    Publications
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-life-ring"></span>
     
    Support
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="support.html">Questions and Bug reports</a>
    </li>
    <li>
      <a href="rSetup.html">R setup</a>
    </li>
    <li>
      <a href="installingHades.html">Installing HADES</a>
    </li>
  </ul>
</li>
<li>
  <a href="contribute.html">
    <span class="fas fa-hand-paper"></span>
     
    Contribute
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-wrench"></span>
     
    Developers
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="community.html">Developer Community</a>
    </li>
    <li>
      <a href="developerGuidelines.html">Developer Guidelines</a>
    </li>
    <li>
      <a href="codeStyle.html">Code Style</a>
    </li>
    <li>
      <a href="releaseProcess.html">Release Process</a>
    </li>
    <li>
      <a href="packageStatuses.html">Package Statuses</a>
    </li>
    <li>
      <a href="developmentRoadmap.html">Development Roadmap</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Developer Guidelines</h1>

</div>


<div id="ohdsi-code-style-for-r" class="section level1">
<h1>OHDSI code style for R</h1>
<p>(Adapted from <a href="http://r-pkgs.had.co.nz/r.html#style" class="uri">http://r-pkgs.had.co.nz/r.html#style</a>)</p>
<div id="case" class="section level2">
<h2>Case</h2>
<p>We use camelCase in R. Function and variable names all start with lowercase. Package names start with uppercase.</p>
<p>Examples:</p>
<ul>
<li><code>cohortData &lt;- loadCohortData("myFolder")</code></li>
<li>The <code>SqlRender</code> package</li>
</ul>
</div>
<div id="naming-conventions" class="section level2">
<h2>Naming conventions</h2>
<p>Function names typically start with a verb. Variable names are typically nouns. Do not encode the data type in the variable names. Also, everything is data, so no need to say that unless unavoidable.</p>
<p><strong>Good</strong></p>
<ul>
<li>The <code>fitOutcomeModel</code> function.</li>
<li>The <code>computeCovariateBalance</code> function.</li>
<li>The <code>population</code> argument.</li>
</ul>
<p><strong>Bad</strong></p>
<ul>
<li><code>sampling</code> as variable name (not a noun)</li>
<li><code>namesVector</code>, <code>covariatesDf</code> (encodes the data type)</li>
<li><code>getResultData</code> (everything is data)</li>
</ul>
</div>
<div id="spacing" class="section level2">
<h2>Spacing</h2>
<p>Place spaces around all infix operators (<code>=</code>, <code>+</code>, <code>-</code>, <code>&lt;-</code>, etc.). The same rule applies when using <code>=</code> in function calls. Always put a space after a comma, and never before (just like in regular English).</p>
<p><strong>Good</strong></p>
<pre class="r"><code>average &lt;- mean(feet / 12 + inches, na.rm = TRUE)</code></pre>
<p><strong>Bad</strong></p>
<pre class="r"><code>average&lt;-mean(feet/12+inches,na.rm=TRUE)</code></pre>
<p>There’s a small exception to this rule: <code>:</code>, <code>::</code> and <code>:::</code> don’t need spaces around them.</p>
<p><strong>Good</strong></p>
<pre class="r"><code>x &lt;- 1:10</code></pre>
<pre class="r"><code>base::get</code></pre>
<p><strong>Bad</strong></p>
<pre class="r"><code>x &lt;- 1 : 10
base :: get</code></pre>
<p>Place a space before left parentheses, except in a function call.</p>
<p><strong>Good</strong></p>
<pre class="r"><code>if (debug) {
  do(x)
}

plot(x, y)</code></pre>
<p><strong>Bad</strong></p>
<pre class="r"><code>if(debug){
  do(x)
}

plot (x, y)</code></pre>
<p>Extra spacing (i.e., more than one space in a row) is ok if it improves alignment of equal signs or assignments (<code>&lt;-</code>).</p>
<p>Do not place spaces around code in parentheses or square brackets (unless there’s a comma, in which case see above).</p>
<p><strong>Good</strong></p>
<pre class="r"><code>if (debug) {
  do(x)
}

diamonds[5, ]</code></pre>
<p><strong>Bad</strong></p>
<pre class="r"><code>if ( debug ) {  # No spaces around debug
  do(x)
}

x[1,]   # Needs a space after the comma
x[1 ,]  # Space goes after comma not beforeCurly braces</code></pre>
<p>An opening curly brace should never go on its own line and should always be followed by a new line. A closing curly brace should always go on its own line, unless it’s followed by else.</p>
</div>
<div id="indentation" class="section level2">
<h2>Indentation</h2>
<p>Always indent the code inside curly braces. It’s ok to leave very short statements on the same line:</p>
<pre class="r"><code>if (y &lt; 0 &amp;&amp; debug) {
  message(&quot;Y is negative&quot;)
}</code></pre>
<p>Strive to limit your code to 100 characters per line. This fits comfortably on a printed page with a reasonably sized font. If you find yourself running out of room, this is a good indication that you should encapsulate some of the work in a separate function.</p>
<p>When indenting your code, use tabs. Never use spaces or mix tabs and spaces.</p>
<p>Hint: In RStudio you can use ctrl-i to automatically indent the code for you.</p>
</div>
<div id="assignment" class="section level2">
<h2>Assignment</h2>
<p>Use &lt;-, not =, for assignment.</p>
<p><strong>Good</strong></p>
<pre class="r"><code>x &lt;- 5</code></pre>
<p><strong>Bad</strong></p>
<pre class="r"><code>x = 5</code></pre>
</div>
<div id="if-then-else" class="section level2">
<h2>If-then-else</h2>
<p>If-then-else clauses should always use curly brackets, even if there’s only one clause and it’s one statement.</p>
<p><strong>Good</strong></p>
<pre class="r"><code>if (a == b) {
  doSomething()
}</code></pre>
<p><strong>Bad</strong></p>
<pre class="r"><code>if (a == b) doSomething()</code></pre>
</div>
<div id="use-named-arguments" class="section level2">
<h2>Use named arguments</h2>
<p>When calling a function that has more than one argument, make sure to refer to each argument by name instead of relying on the order of arguments.</p>
<p><strong>Good</strong></p>
<pre class="r"><code>translateSql(sql = &quot;COMMIT&quot;, targetDialect = &quot;PDW&quot;)</code></pre>
<p><strong>Bad</strong></p>
<pre class="r"><code>translateSql(&quot;COMMIT&quot;, &quot;PDW&quot;)</code></pre>
</div>
<div id="commenting-guidelines" class="section level2">
<h2>Commenting guidelines</h2>
<p>Comment your code only where the intent is not immediately obvious. Each line of a comment should begin with the comment symbol and a single space: <code>#</code>. Comments should explain the why, not the what.</p>
<p>Use commented lines of <code>-</code> to break up your file into easily readable chunks, for example:</p>
<pre class="r"><code>## Load data ---------------------------
x &lt;- readRDS(&quot;data.rds&quot;)

## Plot data ---------------------------
plot(x)</code></pre>
</div>
<div id="curly-brackets-and-new-line" class="section level2">
<h2>Curly brackets and new line</h2>
<p>Opening curly brackets should precede a new line. A closing curly bracket should be followed by a new line except when it is followed by <code>else</code> or a closing parenthesis.</p>
<p><strong>Good</strong></p>
<pre class="r"><code>if (a == b) {
  doSomething()
} else {
  doSomethingElse()
}</code></pre>
<p><strong>Bad</strong></p>
<pre class="r"><code>if (a == b) 
{
  doSomething()
} 
else 
{
  doSomethingElse()
}</code></pre>
</div>
<div id="dplyr-joins-and-merges" class="section level2">
<h2>Dplyr joins and merges</h2>
<p>Dplyr joins and merge statements should always have a ‘by’ argument.</p>
<p><strong>Good</strong></p>
<pre class="r"><code>foo %&gt;% 
  inner_join(bar, by = &quot;covariateId&quot;)</code></pre>
<p><strong>Bad</strong></p>
<pre class="r"><code>foo %&gt;% 
  inner_join(bar)</code></pre>
</div>
</div>
<div id="ohdsi-code-style-for-sql" class="section level1">
<h1>OHDSI code style for SQL</h1>
<p>The OHDSI code style for SQL is heavily inspired by the <a href="http://architectshack.com/PoorMansTSqlFormatter.ashx">Poor Man’s T-SQL Formatter</a>, which is available as a <a href="https://notepad-plus-plus.org/">NotePad++</a> plugin. The only difference with the default settings is that in OHDSI, commas are trailing. You can automatically format your SQL correctly by using the <a href="http://poorsql.com/">Poor Man’s T-SQL Formatter Online Tool</a> (but don’t forget to set Trailing Commas).</p>
<div id="case-1" class="section level2">
<h2>Case</h2>
<p>Because several database platforms are case-insensitive and tend to convert table and field names to either uppercase (e.g. Oracle) or lowercase (e.g. PostgreSQL), we use snake_case. All names should be in lowercase. Reserved words should be in upper case.</p>
<p><strong>Good</strong></p>
<pre class="sql"><code>SELECT COUNT(*) AS person_count FROM person</code></pre>
<p><strong>Bad</strong></p>
<pre class="sql"><code>SELECT COUNT(*) AS personCount FROM person

SELECT COUNT(*) AS Person_Count FROM person

SELECT COUNT(*) AS PERSON_COUNT FROM person

select count(*) as person_count from person</code></pre>
</div>
<div id="commas" class="section level2">
<h2>Commas</h2>
<p>Commas should be trailing.</p>
<p><strong>Good</strong></p>
<pre class="sql"><code>SELECT COUNT(*) AS person_count,
    condition_concept_id,
    condition_type_concept_id
FROM condition_era
GROUP BY condition_concept_id,
    condition_type_concept_id</code></pre>
<p><strong>Bad</strong></p>
<pre class="sql"><code>SELECT COUNT(*) AS person_count
    ,condition_concept_id
    ,condition_type_concept_id
FROM condition_era
GROUP BY condition_concept_id
    ,condition_type_concept_id</code></pre>
</div>
<div id="indentation-and-new-lines" class="section level2">
<h2>Indentation and new lines</h2>
<p>Indentation is done using tabs. Field definitions are followed by a new line.</p>
<p><strong>Good</strong></p>
<pre class="sql"><code>SELECT COUNT(*) AS person_count,
  condition_type_concept_id
FROM (
  SELECT * 
  FROM condition_era
  WHERE condition_concept_id = 123
  ) tmp
GROUP BY condition_type_concept_id;</code></pre>
<p><strong>Bad</strong></p>
<pre class="sql"><code>SELECT COUNT(*) AS person_count, condition_type_concept_id
FROM (SELECT * FROM condition_era WHERE condition_concept_id = 123) tmp
GROUP BY condition_type_concept_id;</code></pre>
</div>
</div>
<div id="interfacing-between-r-and-sql" class="section level1">
<h1>Interfacing between R and SQL</h1>
<p>In R we use camel case, and in SQL we use snake case. Therefore, on the interface between the two languages we must convert from one convention to the other. To facilitate this, the OHDSI <a href="https://ohdsi.github.io/SqlRender/"><code>SqlRender</code></a> and <a href="https://ohdsi.github.io/DatabaseConnector/"><code>DatabaseConnector</code></a> packages provide various features.</p>
<p>In general, in R we can convert from one case to another using the <code>camelCaseToSnakeCase</code> and <code>snakeCaseToCamelcase</code> functions in the <code>SqlRender</code> package:</p>
<pre class="r"><code>data &lt;- data.frame(cohortId = 1,
                   cohortName = &quot;test&quot;)
                   
colnames(data) &lt;- camelCaseToSnakeCase(colnames(data))
colnames(data)
# [1] &quot;cohort_id&quot; &quot;cohort name&quot;

colnames(data) &lt;- snakeCaseToCamelcase(colnames(data))
colnames(data)
# [1] &quot;cohortId&quot; &quot;cohortName&quot;</code></pre>
<div id="when-downloading-data-from-the-database" class="section level2">
<h2>When downloading data from the database</h2>
<p>When downloading data, a shortcut is to use the <code>snakeCaseToCamelcase</code> argument of the <code>querySql</code> function in the <code>DatabaseConnector</code> package:</p>
<pre class="r"><code>sql &lt;- &quot;SELECT cohort_definition_id, subject_id  FROM cdm.cohort;&quot;
cohort &lt;- querySql(connection = connection,
                   sql = sql,
                   snakeCaseToCamelcase = TRUE)</code></pre>
<p>Where <code>cohort</code> will be a data frame with columns <code>cohortDefinitionId</code> and <code>subjectId</code>.</p>
</div>
<div id="when-inserting-data-in-the-database" class="section level2">
<h2>When inserting data in the database</h2>
<p>When uploading data, a shortcut is to use the <code>camelCaseToSnakeCase</code> argument of the <code>insertTable</code> in the <code>DatabaseConnector</code> package:</p>
<pre class="r"><code>dataToInsert &lt;- data.frame(cohortId = 1,
                           cohortName = &quot;test&quot;)

insertTable(connection = connection,
            tableName = &quot;my_table&quot;,
            data = dataToInsert,
            camelCaseToSnakeCase = TRUE)</code></pre>
<p>Where the table called <code>my_table</code> will have columns named <code>cohort_id</code> and <code>cohort_name</code>.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
